# ğŸ“ˆ WEEK DATA FLOW DIAGRAM

## ğŸ”„ COMPLETE DATA FLOW (53 Weeks)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        USER LOADS REPORTS PAGE                   â”‚
â”‚                   Selects: Week X (any of 53 weeks)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              StandardizedDataFetcher.fetchData()                 â”‚
â”‚          Analyzes: Is this week current or historical?           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â–¼                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    HISTORICAL WEEK           â”‚    â”‚     CURRENT WEEK             â”‚
â”‚  (Any past completed week)   â”‚    â”‚  (This week, includes today) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚                                  â”‚
                 â–¼                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Query campaign_summaries    â”‚    â”‚ Check current_week_cache     â”‚
â”‚  WHERE summary_type='weekly' â”‚    â”‚ WHERE client_id = ?          â”‚
â”‚    AND summary_date >= X     â”‚    â”‚   AND last_updated fresh?    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚                                  â”‚
                 â–¼                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚                             â”‚
â”‚  Data found? âœ…               â”‚    â–¼                             â–¼
â”‚  Return instantly (~100ms)   â”‚  FRESH (<3h)            STALE (>3h) OR MISSING
â”‚  Source: "Z bazy danych"     â”‚    â”‚                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â–¼                             â–¼
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚ Return cache â”‚         â”‚ Return stale (50ms)  â”‚
                              â”‚ ~50ms        â”‚         â”‚ + Background refresh â”‚
                              â”‚ "Dane na     â”‚         â”‚ "Cache nieaktualny"  â”‚
                              â”‚  Å¼ywo"       â”‚         â”‚                      â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                                   â”‚
                                                                   â–¼
                                                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                       â”‚ Fetch from Meta API  â”‚
                                                       â”‚ Update cache         â”‚
                                                       â”‚ Next load: fresh!    â”‚
                                                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¤– AUTOMATIC UPDATE FLOW (Production)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         TIME PROGRESSION                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Week 46 (Nov 10-16)          Week 47 (Nov 17-23)       Week 48 (Nov 24-30)
      â”‚                              â”‚                         â”‚
      â–¼                              â–¼                         â–¼
  COMPLETED                      CURRENT                   FUTURE
      â”‚                              â”‚                         â”‚
      â”‚                              â”‚                         â”‚
      â–¼                              â–¼                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚ Database     â”‚            â”‚ Smart Cache  â”‚                  â”‚
â”‚ campaign_    â”‚            â”‚ 3-hour TTL   â”‚                  â”‚
â”‚ summaries    â”‚            â”‚ current_week â”‚                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚ _cache       â”‚                  â”‚
      â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
      â”‚                              â”‚                         â”‚
      â”‚                              â”‚                         â”‚
      â”‚                              â–¼                         â”‚
      â”‚                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
      â”‚                     â”‚ CRON: Every 3h  â”‚               â”‚
      â”‚                     â”‚ Refresh cache   â”‚               â”‚
      â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
      â”‚                              â”‚                         â”‚
      â”‚                              â”‚                         â”‚
      â–¼                              â–¼                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               SUNDAY 2 AM - WEEKLY COLLECTION                    â”‚
â”‚                                                                   â”‚
â”‚  1. Week 47 completes â†’ Becomes historical                       â”‚
â”‚  2. Collect Week 47 full data â†’ Store in campaign_summaries     â”‚
â”‚  3. Week 48 starts â†’ Becomes current                             â”‚
â”‚  4. Clear Week 47 from current_week_cache                        â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                              â”‚                         â”‚
      â–¼                              â–¼                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Week 47      â”‚            â”‚ Week 48      â”‚            â”‚ Future weeks â”‚
â”‚ Database     â”‚            â”‚ Smart Cache  â”‚            â”‚ Not yet      â”‚
â”‚ (permanent)  â”‚            â”‚ (updating)   â”‚            â”‚ collected    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š DATA SOURCE DECISION TREE

```
                        User requests Week X
                               â”‚
                               â–¼
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚ Is Week X       â”‚
                      â”‚ current week?   â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         /          \
                       YES           NO
                       /              \
                      â–¼                â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ Check Smart     â”‚   â”‚ Query Database   â”‚
          â”‚ Cache (3h TTL)  â”‚   â”‚ campaign_        â”‚
          â”‚                 â”‚   â”‚ summaries        â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚                       â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”             â–¼
        â–¼                 â–¼        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ Data     â”‚
   â”‚ Fresh  â”‚      â”‚ Stale/    â”‚  â”‚ found?   â”‚
   â”‚ <3h    â”‚      â”‚ Missing   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
        â”‚                 â”‚        â”Œâ”€â”€â”€â”´â”€â”€â”€â”
        â”‚                 â”‚        â”‚       â”‚
        â–¼                 â–¼       YES      NO
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚       â”‚
   â”‚ Return â”‚      â”‚ Return    â”‚  â–¼       â–¼
   â”‚ 50ms   â”‚      â”‚ stale     â”‚ Return  Fetch
   â”‚ âœ…     â”‚      â”‚ 50ms +    â”‚ 100ms   from
   â”‚        â”‚      â”‚ Refresh   â”‚ âœ…      API
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚ ğŸ”„        â”‚         2-5s
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         âš ï¸
                         â”‚
                         â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚ Update    â”‚
                   â”‚ cache     â”‚
                   â”‚ Next:     â”‚
                   â”‚ fresh! âœ… â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ PERFORMANCE COMPARISON

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      RESPONSE TIME BY WEEK TYPE                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Historical Week (e.g., Week 46 - completed):
â”œâ”€ Query database: 100ms
â”œâ”€ Parse data: 20ms
â”œâ”€ Return to user: 20ms
â””â”€ TOTAL: ~140ms âœ…âœ…âœ… (INSTANT)

Current Week (cached, fresh):
â”œâ”€ Query cache: 50ms
â”œâ”€ Parse data: 20ms
â”œâ”€ Return to user: 20ms
â””â”€ TOTAL: ~90ms âœ…âœ…âœ… (INSTANT)

Current Week (cached, stale):
â”œâ”€ Query cache: 50ms (return stale immediately)
â”œâ”€ Parse data: 20ms
â”œâ”€ Return to user: 20ms
â”œâ”€ [Background] Fetch API: 2000ms (non-blocking)
â”œâ”€ [Background] Update cache: 100ms
â””â”€ TOTAL: ~90ms âœ…âœ… (INSTANT, refresh in background)
     Next load: Fresh data!

Current Week (cache miss):
â”œâ”€ Fetch from API: 2500ms
â”œâ”€ Parse data: 50ms
â”œâ”€ Store in cache: 100ms
â”œâ”€ Return to user: 20ms
â””â”€ TOTAL: ~2670ms âš ï¸ (ACCEPTABLE, first load only)
     Subsequent loads: 90ms instant
```

---

## ğŸ’° COST OPTIMIZATION

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              API CALL FREQUENCY (16 clients)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

WITHOUT Smart Caching:
â”‚
â”‚  Every user page load â†’ API call
â”‚  â”œâ”€ 16 clients
â”‚  â”œâ”€ 10 users per day
â”‚  â”œâ”€ 20 page loads per user
â”‚  â””â”€ = 3,200 API calls/day
â”‚     = $3.20/day ($96/month)
â”‚     = ğŸ’¸ğŸ’¸ğŸ’¸ EXPENSIVE
â”‚

WITH Smart Caching (Current System):
â”‚
â”‚  Current week: Refresh every 3 hours
â”‚  â”œâ”€ 16 clients
â”‚  â”œâ”€ 8 refreshes per day (24h / 3h)
â”‚  â””â”€ = 128 API calls/day
â”‚     = $0.13/day ($4/month)
â”‚     = âœ… 96% COST REDUCTION
â”‚
â”‚  Historical weeks: 0 API calls
â”‚  â”œâ”€ Data in database
â”‚  â”œâ”€ Instant retrieval
â”‚  â””â”€ = $0/month
â”‚     = âœ… FREE
â”‚
```

---

## ğŸ”„ LIFECYCLE OF A WEEK (Week 47 Example)

```
MONDAY, NOV 17 - 00:00 (Week 47 starts)
â”œâ”€ Week 47 becomes "current"
â”œâ”€ No cache yet
â””â”€ First user load: Fetch from API (~2-5s)
    â†“
    Store in current_week_cache
    â†“
    Subsequent loads: Instant (~50ms)

MONDAY, NOV 17 - 03:00 (3 hours later)
â”œâ”€ CRON: refresh-current-week-cache
â”œâ”€ Fetch latest data from API
â””â”€ Update current_week_cache
    â†“
    Users see fresh data (~50ms)

MONDAY, NOV 17 - 06:00, 09:00, 12:00... (Every 3 hours)
â”œâ”€ CRON: refresh-current-week-cache
â”œâ”€ Keep data fresh
â””â”€ Users always see recent data

SUNDAY, NOV 23 - 23:59 (Week 47 ends)
â””â”€ Week 47 is complete (7 full days)

MONDAY, NOV 24 - 02:00 (Sunday night / Monday early morning)
â”œâ”€ CRON: incremental-weekly-collection
â”œâ”€ Detect Week 47 is complete
â”œâ”€ Fetch full Week 47 data from API (final snapshot)
â”œâ”€ Store in campaign_summaries (permanent)
â””â”€ Week 47 is now "historical"
    â†“
    From now on:
    - Week 47: Database read (~100ms) âœ…
    - Week 48: Smart cache (current) âœ…
    - No more API calls for Week 47 âœ…
```

---

## ğŸ¯ KEY TAKEAWAYS

1. âœ… **Historical weeks** (1-52 past): Instant from database (~100ms)
2. âœ… **Current week**: Smart cache (~50ms) with 3-hour refresh
3. âœ… **Automatic updates**: Every 3 hours (current) + Every Sunday (historical)
4. âœ… **Cost optimized**: 96% reduction in API calls
5. âœ… **User experience**: Always instant or near-instant
6. âœ… **No manual work**: Fully automated
7. âœ… **Graceful degradation**: Stale data served instantly while refreshing
8. âœ… **Production ready**: All 16 clients configured

**System is fully operational and production-ready!** ğŸš€

